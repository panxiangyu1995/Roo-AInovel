# 小说框架分块生成系统使用指南

## 概述

小说框架分块生成系统是为解决模型输出限制问题而设计的高级工具，它将复杂的框架生成任务拆分为多个小型子任务，支持断点续传、内容缓存和进度跟踪，确保即使在生成过程中断也能保持完整性并轻松恢复。

## 核心功能

1. **分块生成**：将框架内容拆分为可独立生成的小块
2. **断点续传**：支持在任意点暂停和恢复生成过程
3. **进度跟踪**：自动记录每个内容块的生成状态
4. **模板化内容**：使用预定义模板确保内容结构一致
5. **会话管理**：保存和恢复生成状态和中间结果

## 使用场景

分块生成系统特别适用于以下场景：

- 创建复杂、详细的小说框架
- 分多次完成框架内容生成
- 处理可能因模型限制导致中断的长文本生成
- 需要精细控制框架各部分生成顺序的情况
- 团队协作开发同一部小说框架

## 使用步骤

### 1. 启动分块生成模式

有两种方式启动分块生成模式：

- **在新建框架后**：选择"14. 使用分块生成模式（适合长内容）"
- **在框架完善过程中**：输入包含"分块"、"chunk"或"模板"的选项

### 2. 选择要生成的框架部分

系统会显示可用的模板列表，包括：

- 主题元素(theme)
- 剧情大纲(plot)
- 世界设定(world)
- 角色设计(character)
- 章节规划(chapter)
- 其他可用模板...

您可以选择单个部分、多个部分（用逗号分隔）或输入"all"生成所有部分。

### 3. 逐块填写内容

系统会引导您逐个填写所选部分的内容块：

- 每个部分会拆分为多个子块（如主题部分会拆分为类型、核心主题、象征元素等）
- 对于每个子块，系统会询问相关内容
- 您可以在任何时候选择暂停生成过程

### 4. 暂停与恢复

- 在生成过程中，每完成一个内容块后，系统会询问是否继续
- 选择"否"可暂停生成过程
- 系统会自动保存当前进度
- 下次使用分块生成模式时，可以恢复之前的进度

### 5. 查看生成结果

- 完成所有选定部分的生成后，系统会整合内容并保存到框架文件
- 系统会显示生成的内容以供审查
- 您可以选择继续完善当前部分或返回主菜单

## 示例使用流程

1. 创建新框架后选择"14. 使用分块生成模式"
2. 选择要生成的部分："theme,plot,character"
3. 依次填写各个部分的内容：
   - 主题部分：填写类型、核心主题等
   - 剧情部分：填写故事概要、时间线等
   - 角色部分：填写主角、反派等
4. 生成过程中选择暂停
5. 稍后返回，系统会从上次停止的地方继续

## 技术细节

分块生成系统基于以下核心组件：

- **ContentTemplateManager**：管理内容模板和渲染
- **ChunkGenerator**：封装分块生成相关功能
- **会话存储机制**：保存在`.novel-framework/sessions`目录下
- **进度跟踪系统**：记录在`progress.json`文件中

## 高级用法

### 自定义模板

高级用户可以扩展现有模板或创建新模板：

1. 在`ContentTemplateManager.initializeTemplates`方法中添加新模板
2. 使用现有模板作为参考，创建新的内容结构
3. 为新模板创建对应的生成方法

### 模板语法

模板支持以下语法特性：

- 变量替换：`{{variable}}`
- 条件语句：`{{#if condition}}...{{else}}...{{/if}}`
- 循环：`{{#each array}}...{{/each}}`
- 函数：`{{multiply x y}}`

## 故障排除

### 常见问题

1. **生成中断**：
   - 确认您的会话ID并使用分块生成模式重新进入
   - 系统会自动从中断点继续

2. **内容未保存**：
   - 检查`.novel-framework/sessions`目录中的会话文件
   - 确保有足够的磁盘空间和写入权限

3. **模板渲染错误**：
   - 检查输入数据格式是否正确
   - 尝试使用更简单的内容重新生成

## 未来发展

分块生成系统将在未来版本中得到进一步增强：

1. 添加更多预定义模板
2. 支持自定义模板导入
3. 增强模板语法功能
4. 添加内容版本控制
5. 实现更智能的内容合并算法

---

通过使用分块生成系统，您可以克服模型输出限制，创建更加详细、系统化的小说框架，同时享受更加灵活、可靠的生成体验。 